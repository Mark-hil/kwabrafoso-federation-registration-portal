{% extends 'members/base2.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}

<div class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50/20">
  <!-- Background Pattern -->
  <div class="fixed inset-0 opacity-3 pointer-events-none">
    <div class="absolute inset-0" style="background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23000000" fill-opacity="0.4"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
  </div>

  <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Dashboard Header -->
    <div class="text-center mb-12">
      <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-orange-400 via-orange-500 to-orange-600 rounded-3xl shadow-xl mb-6 transform hover:scale-105 transition-transform duration-300">
        <i class="fas fa-chart-line text-white text-3xl"></i>
      </div>
      <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 bg-clip-text text-transparent mb-4">
        Church Management Dashboard
      </h1>
      <p class="text-gray-600 text-xl max-w-3xl mx-auto mb-6">
        Comprehensive analytics and insights for your growing church community
      </p>
      <div class="flex items-center justify-center gap-4 text-sm text-gray-500">
        <div class="flex items-center gap-2">
          <i class="far fa-clock"></i>
          <span>Last updated: {% now "F j, Y, g:i a" %}</span>
        </div>
        <div class="w-px h-4 bg-gray-300"></div>
        <div class="flex items-center gap-2">
          <i class="fas fa-users"></i>
          <span>{{ total_members }} Total Members</span>
        </div>
      </div>
    </div>

    <!-- Key Metrics Overview -->
    <div class="mb-12">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Key Metrics</h2>
        <div class="flex items-center gap-2 text-sm text-gray-500">
          <i class="fas fa-info-circle"></i>
          <span>Real-time data</span>
        </div>
      </div>
      
      <!-- Summary Cards -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Total Members -->
        <div class="group relative bg-gradient-to-br from-blue-50 to-blue-100 rounded-3xl shadow-lg hover:shadow-2xl transition-all duration-500 overflow-hidden border border-blue-200/50">
          <div class="absolute inset-0 bg-gradient-to-br from-blue-500/10 to-blue-600/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
          <div class="relative p-8">
            <div class="flex items-start justify-between mb-6">
              <div class="flex items-center justify-center w-16 h-16 bg-white rounded-2xl shadow-md">
                <i class="fas fa-users text-blue-600 text-2xl"></i>
              </div>
              <span class="text-xs font-semibold px-3 py-1.5 bg-blue-600 text-white rounded-full shadow-lg">
                Active
              </span>
            </div>
            <h3 class="text-lg font-semibold text-blue-900 mb-3">Total Members</h3>
            <p class="text-5xl font-bold text-blue-900 mb-4">{{ total_members }}</p>
            <div class="flex items-center text-sm">
              {% if member_growth >= 0 %}
                <span class="flex items-center text-green-600 font-medium">
                  <i class="fas fa-arrow-up mr-2"></i>
                  <span>+{{ member_growth }}%</span>
                  <span class="text-gray-600 ml-1">this month</span>
                </span>
              {% else %}
                <span class="flex items-center text-red-600 font-medium">
                  <i class="fas fa-arrow-down mr-2"></i>
                  <span>{{ member_growth }}%</span>
                  <span class="text-gray-600 ml-1">this month</span>
                </span>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Worship Service Attendance -->
        <div class="group relative bg-gradient-to-br from-green-50 to-green-100 rounded-3xl shadow-lg hover:shadow-2xl transition-all duration-500 overflow-hidden border border-green-200/50">
          <div class="absolute inset-0 bg-gradient-to-br from-green-500/10 to-green-600/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
          <div class="relative p-8">
            <div class="flex items-start justify-between mb-6">
              <div class="flex items-center justify-center w-16 h-16 bg-white rounded-2xl shadow-md">
                <i class="fas fa-church text-green-600 text-2xl"></i>
              </div>
              <span class="text-xs font-semibold px-3 py-1.5 bg-green-600 text-white rounded-full shadow-lg">
                Today
              </span>
            </div>
            <h3 class="text-lg font-semibold text-green-900 mb-3">Lectures Service</h3>
            <p class="text-5xl font-bold text-green-900 mb-4">{{ worship_service_count }}</p>
            <div class="flex items-center text-sm">
              {% if worship_growth >= 0 %}
                <span class="flex items-center text-green-600 font-medium">
                  <i class="fas fa-arrow-up mr-2"></i>
                  <span>+{{ worship_growth }}%</span>
                  <span class="text-gray-600 ml-1">increase</span>
                </span>
              {% else %}
                <span class="flex items-center text-red-600 font-medium">
                  <i class="fas fa-arrow-down mr-2"></i>
                  <span>{{ worship_growth }}%</span>
                  <span class="text-gray-600 ml-1">decrease</span>
                </span>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Event Attendance -->
        <div class="group relative bg-gradient-to-br from-purple-50 to-purple-100 rounded-3xl shadow-lg hover:shadow-2xl transition-all duration-500 overflow-hidden border border-purple-200/50">
          <div class="absolute inset-0 bg-gradient-to-br from-purple-500/10 to-purple-600/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
          <div class="relative p-8">
            <div class="flex items-start justify-between mb-6">
              <div class="flex items-center justify-center w-16 h-16 bg-white rounded-2xl shadow-md">
                <i class="fas fa-calendar-star text-purple-600 text-2xl"></i>
              </div>
              <span class="text-xs font-semibold px-3 py-1.5 bg-purple-600 text-white rounded-full shadow-lg">
                Events
              </span>
            </div>
            <h3 class="text-lg font-semibold text-purple-900 mb-3">Event Attendance</h3>
            <p class="text-5xl font-bold text-purple-900 mb-4">{{ event_attendance_count }}</p>
            <div class="flex items-center text-sm">
              {% if event_growth <= 0 %}
                <span class="flex items-center text-green-600 font-medium">
                  <i class="fas fa-arrow-up mr-2"></i>
                  <span>+{{ event_growth|stringformat:"+d"|slice:"1:" }}%</span>
                  <span class="text-gray-600 ml-1">change</span>
                </span>
              {% else %}
                <span class="flex items-center text-red-600 font-medium">
                  <i class="fas fa-arrow-down mr-2"></i>
                  <span>-{{ event_growth }}%</span>
                  <span class="text-gray-600 ml-1">change</span>
                </span>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Visitors Today -->
        <div class="group relative bg-gradient-to-br from-orange-50 to-orange-100 rounded-3xl shadow-lg hover:shadow-2xl transition-all duration-500 overflow-hidden border border-orange-200/50">
          <div class="absolute inset-0 bg-gradient-to-br from-orange-500/10 to-orange-600/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
          <div class="relative p-8">
            <div class="flex items-start justify-between mb-6">
              <div class="flex items-center justify-center w-16 h-16 bg-white rounded-2xl shadow-md">
                <i class="fas fa-user-friends text-orange-600 text-2xl"></i>
              </div>
              <span class="text-xs font-semibold px-3 py-1.5 bg-orange-600 text-white rounded-full shadow-lg">
                New
              </span>
            </div>
            <h3 class="text-lg font-semibold text-orange-900 mb-3">Visitors Today</h3>
            <p class="text-5xl font-bold text-orange-900 mb-4">{{ visitors_today }}</p>
            <div class="flex items-center text-sm text-gray-600 font-medium">
              <i class="far fa-calendar-check mr-2"></i>
              <span>First-time guests</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Analytics & Insights Section -->
    <div class="mb-12">
      <div class="flex items-center justify-between mb-8">
        <div>
          <h2 class="text-2xl font-bold text-gray-900 mb-2">Analytics & Insights</h2>
          <p class="text-gray-600">Visual representation of your church community data</p>
        </div>
        <div class="flex items-center gap-3">
          <button class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors shadow-sm">
            <i class="fas fa-download mr-2"></i>Export Report
          </button>
          <button class="px-4 py-2 text-sm font-medium text-white bg-orange-500 rounded-lg hover:bg-orange-600 transition-colors shadow-sm">
            <i class="fas fa-sync-alt mr-2"></i>Refresh Data
          </button>
        </div>
      </div>

      <!-- Charts Grid -->
      <div class="grid grid-cols-1 gap-6 mb-8">
        <!-- Attendance Trends - Full Width -->
        <div class="bg-white rounded-3xl shadow-lg p-8 border border-gray-100">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="text-xl font-bold text-gray-900 mb-1">Attendance Trends</h3>
              <p class="text-sm text-gray-500">Last 7 days overview</p>
            </div>
            <div class="flex items-center gap-2">
              <button class="px-3 py-1.5 text-xs font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                Week
              </button>
              <button class="px-3 py-1.5 text-xs font-medium text-white bg-orange-500 rounded-lg hover:bg-orange-600 transition-colors">
                Month
              </button>
              <button class="px-3 py-1.5 text-xs font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                Year
              </button>
            </div>
          </div>
          <div class="h-80">
            <canvas id="attendanceTrendChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Distribution Charts Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Church Distribution -->
        <div class="bg-white rounded-3xl shadow-lg p-8 border border-gray-100">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="text-xl font-bold text-gray-900 mb-1">Church Distribution</h3>
              <p class="text-sm text-gray-500">Members by church</p>
            </div>
            <i class="fas fa-church text-gray-400 text-xl"></i>
          </div>
          <div class="h-64">
            <canvas id="churchChart"></canvas>
          </div>
        </div>

        <!-- District Distribution -->
        <div class="bg-white rounded-3xl shadow-lg p-8 border border-gray-100">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="text-xl font-bold text-gray-900 mb-1">District Distribution</h3>
              <p class="text-sm text-gray-500">Members by district</p>
            </div>
            <i class="fas fa-map-marked-alt text-gray-400 text-xl"></i>
          </div>
          <div class="h-64">
            <canvas id="districtChart"></canvas>
          </div>
        </div>

        <!-- Gender Distribution -->
        <div class="bg-white rounded-3xl shadow-lg p-8 border border-gray-100">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="text-xl font-bold text-gray-900 mb-1">Gender Distribution</h3>
              <p class="text-sm text-gray-500">Member demographics</p>
            </div>
            <i class="fas fa-venus-mars text-gray-400 text-xl"></i>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-4 text-center border border-blue-200">
              <div class="text-3xl font-bold text-blue-600 mb-1">{{ gender_counts.male }}</div>
              <div class="text-sm font-medium text-blue-700">Male</div>
            </div>
            <div class="bg-gradient-to-br from-pink-50 to-pink-100 rounded-2xl p-4 text-center border border-pink-200">
              <div class="text-3xl font-bold text-pink-600 mb-1">{{ gender_counts.female }}</div>
              <div class="text-sm font-medium text-pink-700">Female</div>
            </div>
          </div>
          <div class="h-48">
            <canvas id="genderChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed Analytics Section -->
    <div class="mb-12">
      <div class="flex items-center justify-between mb-8">
        <div>
          <h2 class="text-2xl font-bold text-gray-900 mb-2">Detailed Analytics</h2>
          <p class="text-gray-600">Comprehensive breakdown of community data</p>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Registrations by Church -->
        <div class="bg-white rounded-3xl shadow-lg p-8 border border-gray-100">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-gray-900">By Church</h3>
            <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
              <i class="fas fa-church text-blue-600"></i>
            </div>
          </div>
          <div class="space-y-3 max-h-80 overflow-y-auto">
            {% for item in registrations_by_church %}
              <div class="flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl hover:from-blue-50 hover:to-blue-100 transition-all duration-300 group">
                <div class="flex items-center">
                  <div class="w-3 h-3 bg-blue-500 rounded-full mr-3 group-hover:scale-125 transition-transform"></div>
                  <span class="text-sm font-semibold text-gray-700 group-hover:text-blue-700 transition-colors">{{ item.church|default:'Unknown' }}</span>
                </div>
                <span class="text-sm font-bold text-gray-900 bg-white px-3 py-1 rounded-lg shadow-sm">{{ item.count }}</span>
              </div>
            {% empty %}
              <div class="text-center py-12 text-gray-500">
                <i class="fas fa-inbox text-3xl mb-3"></i>
                <p class="text-sm font-medium">No data available</p>
              </div>
            {% endfor %}
          </div>
        </div>

        <!-- Registrations by District -->
        <div class="bg-white rounded-3xl shadow-lg p-8 border border-gray-100">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-gray-900">By District</h3>
            <div class="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center">
              <i class="fas fa-map-marked-alt text-green-600"></i>
            </div>
          </div>
          <div class="space-y-3 max-h-80 overflow-y-auto">
            {% for item in registrations_by_district %}
              <div class="flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl hover:from-green-50 hover:to-green-100 transition-all duration-300 group">
                <div class="flex items-center">
                  <div class="w-3 h-3 bg-green-500 rounded-full mr-3 group-hover:scale-125 transition-transform"></div>
                  <span class="text-sm font-semibold text-gray-700 group-hover:text-green-700 transition-colors">{{ item.district|default:'Unknown' }}</span>
                </div>
                <span class="text-sm font-bold text-gray-900 bg-white px-3 py-1 rounded-lg shadow-sm">{{ item.count }}</span>
              </div>
            {% empty %}
              <div class="text-center py-12 text-gray-500">
                <i class="fas fa-inbox text-3xl mb-3"></i>
                <p class="text-sm font-medium">No data available</p>
              </div>
            {% endfor %}
          </div>
        </div>

        <!-- Room Allocation -->
        <div class="bg-white rounded-3xl shadow-lg p-8 border border-gray-100">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-gray-900">Room Allocation</h3>
            <div class="w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center">
              <i class="fas fa-door-open text-purple-600"></i>
            </div>
          </div>
          <div class="mb-4">
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600">Occupancy Rate</span>
              <span class="font-bold text-gray-900">{{ rooms_with_members }}/{{ total_rooms }} rooms</span>
            </div>
          </div>
          <div class="space-y-3 max-h-80 overflow-y-auto">
            {% for r in room_stats %}
              <div class="p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl hover:from-purple-50 hover:to-purple-100 transition-all duration-300">
                <div class="flex items-center justify-between mb-3">
                  <span class="text-sm font-bold text-gray-900">{{ r.name }}</span>
                  <span class="text-xs font-medium text-gray-600 bg-white px-2 py-1 rounded-full">{{ r.member_count }}/{{ r.capacity }}</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                  <div class="bg-gradient-to-r from-purple-400 to-purple-600 h-3 rounded-full transition-all duration-500 shadow-sm" 
                       style="width: {{ r.occupancy_pct }}%"></div>
                </div>
                <div class="text-xs text-gray-600 mt-2 text-center font-medium">{{ r.occupancy_pct }}% Full</div>
              </div>
            {% empty %}
              <div class="text-center py-12 text-gray-500">
                <i class="fas fa-door-open text-3xl mb-3"></i>
                <p class="text-sm font-medium">No rooms configured</p>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions Section -->
    <div class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 rounded-3xl shadow-2xl p-10 text-white border border-gray-800">
      <div class="text-center mb-10">
        <h2 class="text-3xl font-bold mb-3">Quick Actions</h2>
        <p class="text-gray-300 text-lg">Manage your church community efficiently</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <a href="{% url 'add_member' %}" class="group bg-white/10 backdrop-blur-sm rounded-2xl p-8 hover:bg-white/20 transition-all duration-300 border border-white/20 hover:border-white/40 hover:scale-105">
          <div class="flex flex-col items-center text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform shadow-lg">
              <i class="fas fa-user-plus text-white text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-3">Register Member</h3>
            <p class="text-gray-300">Add new members to the community</p>
          </div>
        </a>
        
        <a href="{% url 'add_visitor' %}" class="group bg-white/10 backdrop-blur-sm rounded-2xl p-8 hover:bg-white/20 transition-all duration-300 border border-white/20 hover:border-white/40 hover:scale-105">
          <div class="flex flex-col items-center text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform shadow-lg">
              <i class="fas fa-user-friends text-white text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-3">Register Visitor</h3>
            <p class="text-gray-300">Track first-time guests</p>
          </div>
        </a>
        
        <a href="{% url 'attendance_report' %}" class="group bg-white/10 backdrop-blur-sm rounded-2xl p-8 hover:bg-white/20 transition-all duration-300 border border-white/20 hover:border-white/40 hover:scale-105">
          <div class="flex flex-col items-center text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform shadow-lg">
              <i class="fas fa-chart-bar text-white text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-3">View Reports</h3>
            <p class="text-gray-300">Analytics and insights</p>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Parse chart data from JSON strings injected by the view
    const trendLabels = {{ trend_labels|safe }} || [];
    const trendData = {{ trend_data|safe }} || [];
    const churchDataRaw = {{ registrations_by_church|safe }} || [];
    const districtDataRaw = {{ registrations_by_district|safe }} || [];
    const genderDataRaw = {{ gender_counts|safe }} || {};

    // Attendance Trend Chart
    const trendConfig = {
      type: 'line',
      data: {
        labels: trendLabels,
        datasets: [{
          label: 'Attendance',
          data: trendData,
          borderColor: '#f97316',
          backgroundColor: 'rgba(249, 115, 22, 0.1)',
          borderWidth: 3,
          tension: 0.4,
          fill: true,
          pointBackgroundColor: '#f97316',
          pointBorderColor: '#fff',
          pointBorderWidth: 2,
          pointRadius: 4,
          pointHoverRadius: 6
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            padding: 12,
            cornerRadius: 8,
            titleFont: { size: 14 },
            bodyFont: { size: 13 }
          }
        },
        scales: {
          x: { 
            grid: { display: false },
            ticks: { font: { size: 11 } }
          },
          y: { 
            grid: { 
              color: 'rgba(156, 163, 175, 0.1)',
              drawBorder: false
            },
            ticks: { font: { size: 11 } }
          }
        }
      }
    };
    new Chart(document.getElementById('attendanceTrendChart'), trendConfig);

    // Church distribution bar chart (top 8 churches)
    const churchLabels = churchDataRaw.slice(0, 8).map(i => i.church || 'Unknown');
    const churchCounts = churchDataRaw.slice(0, 8).map(i => i.count || 0);
    if (churchLabels.length) {
      new Chart(document.getElementById('churchChart'), {
        type: 'bar',
        data: {
          labels: churchLabels,
          datasets: [{
            label: 'Members',
            data: churchCounts,
            backgroundColor: [
              '#3b82f6',
              '#10b981', 
              '#f59e0b',
              '#ef4444',
              '#8b5cf6',
              '#ec4899',
              '#06b6d4',
              '#84cc16'
            ],
            borderWidth: 0,
            borderRadius: 8,
            barThickness: 'flex',
            maxBarThickness: 40
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              padding: 12,
              cornerRadius: 8,
              titleFont: { size: 14 },
              bodyFont: { size: 13 }
            }
          },
          scales: {
            x: { 
              grid: { display: false },
              ticks: { 
                font: { size: 11 },
                maxRotation: 45,
                minRotation: 0
              }
            },
            y: { 
              grid: { 
                color: 'rgba(156, 163, 175, 0.1)',
                drawBorder: false
              },
              ticks: { font: { size: 11 } },
              beginAtZero: true
            }
          }
        }
      });
    }

    // District distribution bar chart (top 8 districts)
    const districtLabels = districtDataRaw.slice(0, 8).map(i => i.district || 'Unknown');
    const districtCounts = districtDataRaw.slice(0, 8).map(i => i.count || 0);
    if (districtLabels.length) {
      new Chart(document.getElementById('districtChart'), {
        type: 'bar',
        data: {
          labels: districtLabels,
          datasets: [{
            label: 'Members',
            data: districtCounts,
            backgroundColor: [
              '#f59e0b',
              '#ef4444',
              '#8b5cf6',
              '#ec4899',
              '#06b6d4',
              '#84cc16',
              '#f97316',
              '#6366f1'
            ],
            borderWidth: 0,
            borderRadius: 8,
            barThickness: 'flex',
            maxBarThickness: 40
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              padding: 12,
              cornerRadius: 8,
              titleFont: { size: 14 },
              bodyFont: { size: 13 }
            }
          },
          scales: {
            x: { 
              grid: { display: false },
              ticks: { 
                font: { size: 11 },
                maxRotation: 45,
                minRotation: 0
              }
            },
            y: { 
              grid: { 
                color: 'rgba(156, 163, 175, 0.1)',
                drawBorder: false
              },
              ticks: { font: { size: 11 } },
              beginAtZero: true
            }
          }
        }
      });
    }

    // Gender doughnut chart
    const maleCount = genderDataRaw.male || 0;
    const femaleCount = genderDataRaw.female || 0;
    new Chart(document.getElementById('genderChart'), {
      type: 'doughnut',
      data: {
        labels: ['Male', 'Female'],
        datasets: [{
          data: [maleCount, femaleCount],
          backgroundColor: ['#3b82f6', '#ec4899'],
          borderWidth: 0,
          hoverOffset: 4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              padding: 20,
              font: { size: 12 },
              usePointStyle: true,
              pointStyle: 'circle'
            }
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            padding: 12,
            cornerRadius: 8
          }
        },
        cutout: '70%'
      }
    });

    // Entrance animation
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry, index) => {
        if (entry.isIntersecting) {
          setTimeout(() => {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
          }, index * 100);
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.bg-white, .bg-gradient-to-r').forEach(el => {
      el.style.opacity = '0';
      el.style.transform = 'translateY(20px)';
      el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
      observer.observe(el);
    });
  });
</script>
{% endblock %}